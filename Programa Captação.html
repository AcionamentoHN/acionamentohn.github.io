<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets Integration</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-5">
    <div class="row">
        <div class="col-md-6">
            <h2>Google Sheets Integration</h2>
            <form id="googleSheetsForm">
                <div class="form-group">
                    <label for="placa">Placa:</label>
                    <input type="text" class="form-control" id="placa" name="placa">
                </div>
                <div class="form-group">
                    <label for="nome">Nome:</label>
                    <input type="text" class="form-control" id="nome" name="nome">
                </div>
                <button type="button" class="btn btn-primary" onclick="submitData()">Enviar</button>
            </form>
        </div>
    </div>

    <div class="row mt-5">
        <div class="col-md-6">
            <h2>Dados na Planilha</h2>
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Placa</th>
                        <th scope="col">Nome</th>
                    </tr>
                </thead>
                <tbody id="tabela">
                    <!-- Dados da planilha serão exibidos aqui -->
                </tbody>
            </table>
            <button id="editar" class="btn btn-primary">Editar Dados</button>
        </div>
    </div>
</div>

<!-- Bootstrap JS and jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    function handleClientLoad() {
        gapi.load('client', function() {
            gapi.client.init({
                apiKey: 'AIzaSyAxGbdWe639fXoxSAnogiMC_sJBFn5uXsk',
                discoveryDocs: ["https://sheets.googleapis.com/$discovery/v4/spreadsheets/1widc-6fjPQ6zVmuVKj2xG3kxSf9LuHXLHDrCEy1nyTo"]
            }).then(function() {
                // Função para enviar dados para a planilha
                window.submitData = function() {
                    var formData = new FormData(document.getElementById('googleSheetsForm'));
                    var placa = formData.get('placa');
                    var nome = formData.get('nome');
                    var values = [
                        [placa, nome]
                    ];

                    var spreadsheetId = '1widc-6fjPQ6zVmuVKj2xG3kxSf9LuHXLHDrCEy1nyTo';
                    var range = 'CADASTRO!A:B';

                    gapi.client.sheets.spreadsheets.values.append({
                        spreadsheetId: spreadsheetId,
                        range: range,
                        valueInputOption: 'RAW',
                        resource: {
                            values: values
                        }
                    }).then(function(response) {
                        alert('Dados enviados com sucesso!');
                        lerDados(); // Atualiza a tabela após enviar os dados
                    }, function(reason) {
                        console.error('Erro ao enviar dados: ' + reason.result.error.message);
                        alert('Erro ao enviar dados. Por favor, tente novamente mais tarde.');
                    });
                };

                // Ler dados da planilha e exibir na tabela
                function lerDados() {
                    var spreadsheetId = '1widc-6fjPQ6zVmuVKj2xG3kxSf9LuHXLHDrCEy1nyTo';
                    var range = 'CADASTRO!A:B';

                    gapi.client.sheets.spreadsheets.values.get({
                        spreadsheetId: spreadsheetId,
                        range: range
                    }).then(function(response) {
                        var values = response.result.values;

                        // Limpar tabela antes de adicionar novos dados
                        var tabela = document.getElementById('tabela');
                        tabela.innerHTML = '';

                        // Exibir dados na tabela
                        for (var i = 0; i < values.length; i++) {
                            var linha = '<tr>';
                            for (var j = 0; j < values[i].length; j++) {
                                linha += '<td>' + values[i][j] + '</td>';
                            }
                            linha += '</tr>';
                            tabela.innerHTML += linha;
                        }
                    });
                }

                // Chamar função para ler dados ao carregar a página
                lerDados();
            });
        });
    }

    // Carregar a API Google Sheets
    handleClientLoad();
</script>

<!-- Load the API client -->
<script async defer src="https://apis.google.com/js/api.js" onload="this.onload=function(){};handleClientLoad()" onreadystatechange="if (this.readyState === 'complete') this.onload()">
</script>

</body>
</html>
